"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getPools = void 0;
const UniswapV2Factory_json_1 = __importDefault(require("@uniswap/v2-core/build/UniswapV2Factory.json"));
const UniswapV2Pair_json_1 = __importDefault(require("@uniswap/v2-core/build/UniswapV2Pair.json"));
const protocol_contracts_1 = require("@zetachain/protocol-contracts");
const ethers_1 = require("ethers");
const getPools = async function () {
    const rpc = this.getEndpoint("evm", `zeta_${this.network}`);
    const provider = new ethers_1.ethers.providers.StaticJsonRpcProvider(rpc);
    const uniswapV2FactoryAddress = (0, protocol_contracts_1.getAddress)("uniswapV2Factory", `zeta_${this.network}`);
    if (!uniswapV2FactoryAddress) {
        throw new Error("uniswapV2Factory is not defined");
    }
    const UniswapV2FactoryContract = new ethers_1.ethers.Contract(uniswapV2FactoryAddress, UniswapV2Factory_json_1.default.abi, provider);
    const totalPairs = await UniswapV2FactoryContract.allPairsLength();
    let pairs = [];
    for (let i = 0; i < totalPairs; i++) {
        pairs.push(await UniswapV2FactoryContract.allPairs(i));
    }
    const poolPromises = pairs.map(async (pair) => {
        let pool = {
            pair,
            t0: {},
            t1: {},
        };
        const pairContract = new ethers_1.ethers.Contract(pair, UniswapV2Pair_json_1.default.abi, provider);
        pool.t0.address = await pairContract.token0();
        pool.t1.address = await pairContract.token1();
        const reserves = await pairContract.getReserves();
        pool.t0.reserve = reserves[0];
        pool.t1.reserve = reserves[1];
        return pool;
    });
    const pools = await Promise.all(poolPromises);
    return pools;
};
exports.getPools = getPools;
